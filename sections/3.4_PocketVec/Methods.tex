\subsection{Methods}
\label{PocketVec_Methods}

\phantomsection
\subsubsection{Selection of compound sets}

Fragments: we downloaded the Glide\cite{friesner_glide_2004, halgren_glide_2004} diverse fragment dataset from the Schrodinger website (\href{https://www.schrodinger.com}{https://www.schrodinger.com}) in November 2020. This collection of compounds is composed of 667 molecules having molecular weights in the 50-200 g·mol\textsuperscript{-1} range (Fig \ref{PocketVec_FigS2}).

Lead-like molecules (LLM): we retrieved a set of 650k lead-like molecules from MOE v2019.01 (Chemical Computing Group, Montreal, Canada). We then performed a k-means clustering using TAT fingerprints, setting the number of clusters to 1,000, and selected the corresponding 1,000 molecules closest to each cluster centroid to build the library. These compounds exhibit molecular weights in the 200-450 g·mol\textsuperscript{-1} range (Fig \ref{PocketVec_FigS2}). 

\phantomsection
\subsubsection{Small molecule docking strategies}

Rigid docking: we performed rigid docking calculations using rDock\cite{ruiz-carmona_rdock_2014} (downloaded on July 2021 from \href{https://github.com/CBDD/rDock}{https://github.com/CBDD/rDock}). We prepared the protein structures using MOE v2019.01 (Chemical Computing Group, Montreal, Canada), Biopython\cite{cock_biopython_2009} and the structure checking utility from BioExcel Building Blocks\cite{andrio_bioexcel_2019}. We ran all docking calculations using standard parameters and scoring functions. The binding site box was built around the pocket centroid (ligand centroid or detected pocket centroid) with a radius of 12 Å (RbtLigandSiteMapper option) and the number of runs was set to 25. Finally, we set the DIHEDRAL\_MODE to FIXED (rigid docking). The considered score for each molecule was the minimum value of SCORE.INTER.

Flexible docking: we used SMINA\cite{koes_lessons_2013} (downloaded on November 2020 from \href{https://sourceforge.net/projects/smina}{https://sourceforge.net/projects/smina}) for the flexible docking calculations. We prepared the protein structures using Reduce\cite{word_asparagine_1999}, OpenBabel\cite{oboyle_open_2011}, Biopython\cite{cock_biopython_2009} and the structure checking utility from BioExcel Building Blocks\cite{andrio_bioexcel_2019}. We ran all the calculations using standard parameters and scoring functions for flexible docking. The binding site box was automatically derived from the position of the bound ligand (autobox\_ligand parameter). The considered score for each molecule was the minimum value of \textit{minimized\_affinity}. 


\phantomsection
\subsubsection{Post-docking analysis}

For each pocket under evaluation, docking scores were stored in a one-dimensional NumPy array\cite{harris_array_2020} and then translated into rankings using SciPy\cite{virtanen_scipy_2020} (\textit{rankdata} function, method \textit{max}). In this way, the molecule with the lowest docking score was assigned the top ranking (1\textsuperscript{st}), while the one with the highest docking score was ranked as the N\textsuperscript{th} (being N the total number of tested molecules; N=128 in the standard PocketVec pipeline). It is important to note that molecules yielding positive docking scores (e.g. due to structural clashes with the protein) were not explicitly considered and their corresponding rankings were set to an outlier value (e.g. 129). The rationale behind this procedure was that such outlier molecules were indeed informative (i.e. the pocket was too small to fit them) but needed to be distinguished from binders having poor (but negative) docking scores (i.e. weak binders). Specifically, docking scores in the range 0-50, 50-100 and >100 were translated into N+1, N+2 and N+3 rankings, respectively (129, 130, 131 in the standard PocketVec pipeline).

\phantomsection
\subsubsection{Benchmark set}

A good strategy to identify the best combination of small molecules and docking methods to develop pocket descriptors, and to assess their validity, is to see if they can faithfully capture reported similarities between small molecule binding pockets. To this end, we used ProSPECCTs\cite{ehrt_benchmark_2018}, a collection of 10 datasets composed of protein-ligand binding site pairs classified as similar or dissimilar according to specific criteria (downloaded in July 2021 from \href{http://www.ewit.ccb.tu-dortmund.de/ag-koch/prospeccts/}{http://www.ewit.ccb.tu-dortmund.de/ag-koch/prospeccts/}). P1 (P1.2) includes 326 (45) protein-ligand complexes involving 12 (12) different proteins, and it is meant to study the sensitivity of pocket comparison tools to the binding site definition by comparing proteins having identical sequences with chemically distinct (similar) ligands located at the same site. P2 comprises 17 PDB files resolved by NMRs, containing a total of 329 different models, and was designed to assess the impact of protein flexibility in pocket comparisons. P3 and P4 include a variable number (1 to 5) of randomly added artificial mutations in the P1 proteins leading to changes in the physicochemical (P3) and physicochemical and shape (P4) properties of the protein binding site. For the sake of simplicity and coherence with reported performances, we have only considered structures with 5 mutations (representing 326 out of 1630 mutated structures). P5 (P5.2) was designed to detect pairs of unrelated proteins binding to identical or similar ligands, and consists of 80 (100, including phosphate binding sites) protein-ligand complexes\cite{kahraman_shape_2007}. P6 (P6.2) is intended to evaluate the identification of distant relationships between pockets binding to identical ligands but having variable pocket environments\cite{barelier_recognition_2015}, and it includes 115 protein structures excluding (including) cofactors. We did not use P6 or P6.2 to benchmark our methodology since all pocket pairs are bound to identical or highly similar ligands, and the similar/dissimilar classification is done considering fine details of protein-ligand binding, such as the involved ligand functional groups. Thus, this set is not appropriate to guide and assess the developments of our pocket descriptors. Finally, P7 was retrieved from published successful applications of pocket similarity studies in a diverse set of proteins, and it contains 1,151 protein structures. A detailed overview of all ProSPECCTs datasets is presented in Fig \ref{PocketVec_FigS3}.

\phantomsection
\subsubsection{Entropy measurements}

For each molecule within each ProSPECCTs dataset, rankings were first binned into 100 different groups (bins) in order to discretize a variable (rankings) that, in practical terms, was continuous (since ranking range was usually higher than the number of considered structures). Shannon's Entropy was then calculated using such binned data (SciPy\cite{virtanen_scipy_2020}, entropy function, base 2).

\phantomsection
\subsubsection{Domain-based characterization of the human druggable pockets}

We searched all human protein identifiers from UniProt (July 2022, \textit{organism\_id 9606} and \textit{reviewed} set to \textit{true}), retrieving a total of 20,386 unique human proteins\cite{the_uniprot_consortium_uniprot_2023}. Then, for each human protein, we retrieved all Pfam domains\cite{mistry_pfam_2021}, considering only those entities labeled as ‘domain’ (e.g. we did not include ‘repeats’). Overall, we found 28,044 domains (2,704 unique Pfam domains) in 11,242 human proteins (Fig \ref{PocketVec_Fig2}a and Fig \ref{PocketVec_FigS15}).

To structurally annotate these domains, we used two different strategies. On the one hand, we looked for experimentally determined structures searching the PDB\cite{goodsell_rcsb_2020}. For each human domain, we gathered all PDB chains showing a structural coverage of the domain ≥80\% using the localpdb package\cite{ludwiczak_localpdb_2022} (PDB version 2022.02.25). We identified at least one PDB structure for 7,774 domains (1,839 unique Pfam domains in 4,726 proteins), processing all PDB files and removing those regions outside the domains under study. Additionally, we downloaded all predicted structures for Homo Sapiens from AlphaFold DB (\href{https://alphafold.ebi.ac.uk/download\#proteomes-section}{https://alphafold.ebi.ac.uk/download\#proteomes-section}, proteins having <2,700 amino acids, August 2022), processed all files and removed those regions that did not match the domains under study, leaving predicted structures for 25,589 domains (2,671 unique Pfam domains in 11,022 proteins).

To identify druggable pockets, we also followed two complementary strategies.

a) Ligand--based. In the ligand-based pocket definition, we identified all the PDB structures (chains) corresponding to human protein domains that contained small molecules (HET PDB codes) co-crystallized with the domains of interest that fulfilled the following criteria: i) being annotated as ligands in PDBSUM\cite{laskowski_pdbsum_2018} data, ii) not being one of the 20 naturally occurring amino acids, iii) having a number of carbon atoms >6, to filter out solvent molecules and crystallography-related species and vi) having solvent accessibility ≤0.4 or buriedness ≥15. We defined solvent accessibility as the ratio between the ligand solvent-accessible surface area (SASA) in the bound state and the ligand SASA in the free state. SASA values were calculated with RDKit (\href{https://www.rdkit.org}{https://www.rdkit.org}). Additionally, we defined buriedness as the number of protein residues having a distance below 8Å to the ligand centroid, and we calculated these values using Biopython\cite{cock_biopython_2009}. The cut-off values for accessibility (0.4) and buriedness (15) were set upon visual inspection of many bound ligands. We considered both parameters in order to recover as many interesting cases as possible: accessibility values usually underestimated pockets defined by small ligands while buriedness values often underrated large pockets. By applying all these conditions, we made sure to consider only pharmacologically relevant small molecules while filtering out inorganic chemicals, short peptides and crystallization additives such as ethylene glycol (EDO), glycerol (GOL), polyethylene glycol (PEG) and DMSO (DMS), among many others. In total, we found at least one PDB structure containing a ligand fulfilling all conditions for 1,279 domains (363 unique Pfam domains in 1,205 proteins). For 503 of these, we only found a single ligand, whereas for 254 of them we could find 10 or more ligands (Fig \ref{PocketVec_FigS16}), including a variety of metabolic nucleotides such as ADP (found in 114 domains, Fig \ref{PocketVec_FigS30}) or GDP (found in 102 domains, Fig \ref{PocketVec_FigS30}).

To compile the list of unique ligand-defined pockets we followed the procedure shown in Fig \ref{PocketVec_Fig2}a. First, we chose a reference PDB structure for each protein domain where we considered the structural coverage of the domain and the resolution of the crystal structure. We then superimposed all domain structures with the corresponding bound ligands onto their reference structure using TM-align\cite{zhang_tm-align_2005}. 

To define a final set of ligand-based druggable pockets per domain, we used a single-linkage clustering technique, merging into a single pocket all those ligands whose centroids were at a distance ≤5Å while maintaining the maximum distance between the global centroid of the cluster and the centroids of the individual compounds ≤18Å. We considered the final global cluster centroids as the pocket centroids. Overall, we found 1,604 ligand-defined pockets in 1,279 protein domains (363 unique Pfam domains in 1,205 proteins). We named this set of pockets \textbf{PDB-LIG}.

We then superimposed the reference PDB structure of the previous domains to their AF2 predicted counterparts by means of TM-align\cite{zhang_tm-align_2005}, and transferred the location of the identified PDB-LIG pockets. We only considered those pockets having a pLDDT value >70 for all the residues at a distance ≤8Å from the pocket centroid. Overall, we identified 1,405 pockets in 1,131 domains (339 unique Pfam domains in 1,074 proteins), and named this set of pockets \textbf{AF2-LIG}.

b) Pocket--detection. As a complementary strategy, and to increase the overall coverage of human druggable pockets, we attempted a \textit{de novo} identification of pockets. To establish a standardized protocol to predict them, we assessed the accuracy of different methods when identifying the PDB-LIG pockets defined above. In brief, we first removed bound ligands from reference \textit{holo} structures (1,279 PDB structures, one per domain) and used Fpocket\cite{le_guilloux_fpocket_2009} and P2rank\cite{krivak_p2rank_2018}, two state-of-the-art methods, to detect pockets in ligand-free domain structures. Additionally, we also used Prank\cite{krivak_improving_2015}, a functionality of P2rank aimed at rescoring the pockets predicted by Fpocket. In this way, we benchmarked three different strategies to detect and score domain binding sites. We considered that a predicted pocket and a ligand-defined pocket matched if the distance between their centroids was ≤6.14Å, which corresponded to the 95\textsuperscript{th} percentile of the distribution of all pairwise distances between ligand centroids within each cluster in the PDB-LIG set (Fig \ref{PocketVec_FigS31}). We found that only 0.18\% and 0.56\% of Fpocket and P2rank predicted pocket pairs, respectively, had a distance between their centroids below that value. Given the apparent over-prediction of pockets of the two methods, we explored the precision/recall balance when keeping only the top scoring predicted pockets. Overall, we found that the best strategy to detect real binding sites in ligand-free structures was the combination of Fpocket detection and Prank scoring. Using the mentioned distance cut-off (6.14Å) and considering the top-2 best scored pockets for each domain, we were able to detect 72\% of the real pockets while 47\% of detected pockets were indeed real (Fig \ref{PocketVec_Fig2}b).

Thus, we first ran Fpocket on the \textit{apo} PDB reference structure for each domain to identify potential druggable pockets, we then ranked them by means of Prank, and we finally kept the top-2 ranked pockets per domain. Overall, this accounted for a total of 14,413 predicted pockets in 7,403 domains (1,806 unique Pfam domains in 4,643 proteins). We named this set of pockets \textbf{PDB-PD}.

We then used the same strategy and criteria as before to detect pockets onto the predicted AF2 domain structures (Fpocket and Prank combination filtering out those pockets having residues with pLDDT values <70), annotating a total of 32,202 pockets in 19,211 domains (2,409 unique Pfam domains in 10,314 proteins). We named this set of pockets \textbf{AF2-PD}.

For each pocket and structure, we calculated pocket volume and buriedness using the rDock CAVITY functionality\cite{ruiz-carmona_rdock_2014} and BioPython\cite{cock_biopython_2009}, respectively.

\phantomsection
\subsubsection{Assessment of the effect of protein flexibility}

To exhaustively assess the behavior of PocketVec descriptors upon protein flexibility and conformational changes, from the PDB-LIG set, we selected those pockets for which we had i) ≥10 experimental structures with a co-crystallized ligand (i.e. \textit{holo}), ii) ≥10 experimental structures without a ligand (i.e. \textit{apo}) and iii) and AF2 structure with pLDDT <70 for all residues at a distance <8Å from the pocket centroid. To avoid biasing the results towards overrepresented pockets, we capped the number of selected PDB structures to 10 in both cases (\textit{holo} and \textit{apo}). Overall, we kept 43 pockets and generated PocketVec descriptors for 10 of their \textit{holo} structures, 10 of their \textit{apo} structures and the corresponding AF2 model, resulting in a total number of 903 PocketVec descriptors (43 pockets x 21 descriptors).

Additionally, we gathered MD data from ATLAS\cite{vandermeersche_atlas_2024}, a repository of standardized MD simulations for 1,390 PDB chains including their calculated trajectories as well as several quantitative analyses. In PDB-LIG (PDB-PD), we found available MD trajectories for 7 (96) of their 1,279 (7,403) domains, encompassing 8 (184) pockets. For each domain (103) we randomly sampled 9 MD frames from ATLAS trajectories (3 random frames per replica, x3 replicas), using the corresponding TPR and XTC GROMACS files. Thus, for each pocket (192), we considered 10 individual structures: the original one from the PDB-LIG/PDB-PD set and 9 frames from the MD simulations. Then, for each pocket, we calculated all pairwise distances (45) among their PocketVec descriptors (10) and compared them with background distances against each of the 4 sets of PocketVec descriptors we already precompiled (i.e. PDB-LIG, PDB-PD, AF2-LIG, AF2-PD).

\phantomsection
\subsubsection{Assessment of the effect of metals binding proteins}

To assess the ability of our precomputed PocketVec descriptors to identify pocket similarities among metal-binding proteins, such as histone deacetylases (HDACs) or matrix metalloproteinases (MMPs), we first collected all domains within the PDB-LIG and PDB-PD sets (7,399) and kept only those having a metal atom (AU, MN, NA, CU, AG, CO, PB, RB, K, SR, FE, MG, CD, NI, HG, CA, PT, TI, ZN or CS) in at least 1 associated PDB chain (3,568). For further analysis, we only considered those PDB-LIG and PDB-PD pockets that were included within one of these domains (1,052 out of 1,594 and 6,882 out of 14,368, respectively). After that and, for each pocket within each set, we individually considered whether any of the associated PDB chains had a metal atom at a distance <6.14Å from the pocket centroid. For those that indeed had at least 1 metal atom (244 and 785 pockets for the PDB-LIG and PDB-PD sets, respectively) we kept it (if it was on the domain reference structure) or superimposed it (randomly selected from associated PDB chains) against the domain reference structure, and generated PocketVec descriptors for them with the explicit presence of the metal atom. 


\phantomsection
\subsubsection{Systematic comparison of druggable pockets within domain families}

First, for each pair of pockets within the AF2-PD and AF2-LIG sets that were located at the same Pfam domains, we computed the correlation between PocketVec similarity (defined as 1-PocketVec distance), sequence identity and Cα RMSD among pockets. We selected a maximum of 10 protein domains per Pfam domain to avoid biasing the results towards the most frequently occurring ones. We then removed those domain pairs having a global TM-score <0.5 and we performed all pairwise residue mappings using the corresponding Pfam multiple sequence alignments (MSA). After that, pockets (residues <8Å to the pocket centroid) were compared on the basis of their sequences and structures (sequence identity and RMSD Cα, respectively). In fact, we only considered those pocket pairs having a sequence alignment coverage ≥80\% and a centroid distance <6.14Å after domain structural alignment, to account for structural variability (see \textit{Pocket detection} in the previous section).

Additionally, we also ran an all-against-all comparison of pockets in the human pocketome (e.g. PDB-LIG, PDB-PD, AF2-LIG and AF2-PD). Global domain structures were compared using TM-align\cite{zhang_tm-align_2005} (Cα RMSD, TM-score), while domain sequence identities were calculated using global pairwise alignments in BioPython\cite{cock_biopython_2009} (Needleman-Wunsch algorithm, BLOSUM62, gap opening = −10, gap extension = −0.5). 

\phantomsection
\subsubsection{Relationship between PocketVec similarity and experimentally determined compound-target pairs}

We obtained raw binding data from the Chemical Checker (v.2024) compound-target space\cite{duran-frigola_extending_2020}, which contains experimental data on 836,654 compounds bound to 6,933 protein targets, as collected from ChEMBL v.33\cite{zdrazil_chembl_2024} and BindingDB v.2024\cite{gilson_bindingdb_2016}. We also collected all PocketVec descriptors from our study (i.e. PDB-LIG, PDB-PD; AF2-LIG and AF2-PD), encompassing a total number of 10,539 proteins. Of these, we had binding data for 2,028 proteins. We then evaluated the corresponding 2,055,378 protein pairs on the bases of the number of shared compounds (in ChEMBL and BindingDB) and the cosine distances between their PocketVec descriptors.

We then calculated the number of protein pairs within each range of PocketVec distances in an all-vs-all comparison of PocketVec descriptors where, for each protein pair, we kept the minimal distance between PocketVec descriptors, regardless of their set of origin (e.g. PDB-LIG, AF2-PD, etc). Additionally, we depicted the number of shared compounds between each protein pair plotted against the minimal PocketVec distance between each pair and, finally, we calculated the Fisher test odds ratio considering a varying number of shared compounds for a PocketVec distance ≤0.17, ≤0.10 and ≤0.05.

We also performed a similar analysis on the fragment-protein binding pairs recently presented\cite{offensperger_large-scale_2024}, where Winter and co-workers comprehensively tested the potential binding of 407 fragment compounds on 5,951 proteins. We applied the filtering criteria defined by the authors in the original manuscript (i.e. log2 fold change >2.3, median normalized log2 fold change >1, p value <0.05 and adjusted p value <0.25) and we ended up with a binary interaction matrix comprising 332 fragment compounds and 2,744 proteins. As also indicated by the authors, we further removed proteins that were frequent hitters (>40 active fragments) as well as those that were rarely hit (<4 active fragments), restricting our analyses to 301 fragment compounds and 525 proteins for which we had PocketVec descriptors. 


\phantomsection
\subsubsection{Comparison of kinase inhibition profiles with PocketVec descriptors, sequence and structure similarity measurements}

We collected experimentally determined binding affinities from Klaeger et al.\cite{klaeger_target_2017} and Reinecke et al.\cite{reinecke_chemical_2023} (Table \ref{PocketVec_TableS2}). We considered undefined measures as inactive, and low-confidence and high-confidence measures were binarized at 30 nM (as recommended in Pharos\cite{nguyen_pharos_2017}). We then removed all compounds that did not inhibit any kinase and all protein kinases that did not have any inhibitor or any PocketVec descriptor in the Protein Kinase Domain (Pfam PF00069). In this way, we eventually defined a binary inhibition matrix between 111 protein kinases and 94 small molecule kinase inhibitors for Klaeger et al. (Fig \ref{PocketVec_Fig7}a and Table \ref{PocketVec_TableS2}a) and between 73 kinases and 164 inhibitors for Reinecke et al. (Fig \ref{PocketVec_Fig7}b and Table \ref{PocketVec_TableS2}b).

We pairwise compared protein kinases on the basis of their binarized inhibition profiles (Jaccard similarity) and their PocketVec descriptors (employing the minimum distance among all PocketVec descriptors within their Protein Kinase Domains PF00069). Additionally, we also performed sequential and structural comparisons between kinases at domain level following the same strategy as in previous sections. In brief, domain structures were compared using TM-align\cite{zhang_tm-align_2005} (Cα RMSD, TM-score) and domain sequence identities were calculated using global pairwise alignments in BioPython\cite{cock_biopython_2009} (Needleman-Wunsch algorithm, BLOSUM62, gap opening = −10, gap extension = −0.5). Only the highest TM-score and sequence identity values among domains were considered for each pair of kinases.